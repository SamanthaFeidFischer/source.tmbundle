<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>beforeRunningCommand</key>
	<string>nop</string>
	<key>command</key>
	<string>PROJECT_FILE=$(ruby -- "${TM_BUNDLE_PATH}/bin/find_xcode_project.rb")

export project="${PROJECT_FILE}/project.pbxproj"
if [[ ! -f ${project} ]]; then
   echo "Didn't find an Xcode project file."
   echo "You may want to set TM_XCODE_PROJECT."
   exit -1
fi

"${TM_RUBY:=ruby}" &lt;&lt;'EOF'
require "#{ENV['TM_SUPPORT_PATH']}/lib/plist"

def shell_escape (str)
   str.gsub(/[`'" $]/, '\\\\\&amp;')
end

prefs = PropertyList::load(%x{defaults read com.apple.Xcode})
dir   = prefs['PBXProductDirectory']

if dir.nil?
   dir = "#{ENV['PWD']}/build"
end

name  = ENV['project']
proj  = PropertyList::load(File.new(name))
objs  = proj['objects']

rootObj = objs[proj['rootObject']]
targets = rootObj['targets']
if targets.size == 1
   target = objs[targets[0]]
   productKey = target['productReference']
   product = objs[productKey]
   file = product['path']
   %x{cd #{shell_escape dir}; open ./#{shell_escape file}}
end

EOF</string>
	<key>input</key>
	<string>none</string>
	<key>keyEquivalent</key>
	<string>@r</string>
	<key>name</key>
	<string>Run (xcode target)</string>
	<key>output</key>
	<string>showAsTooltip</string>
	<key>scope</key>
	<string>source</string>
	<key>uuid</key>
	<string>779DEA3C-D310-4B66-9531-DF9007434878</string>
</dict>
</plist>
